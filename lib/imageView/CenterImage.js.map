{"version":3,"names":[],"mappings":"","sources":["imageView/CenterImage.js"],"sourcesContent":["/**\n * @file CenterImage\n * https://github.com/Caesor/react-imageview\n * @author cgzero(cgzero@cgzero.com)\n * @data 2017-07-09\n */\n\nimport {h, Component} from 'preact';\nimport Icon from '../icon/Icon';\nimport {setStyle} from '../util/dom';\n\n\n/**\n * 预加载数量\n *\n * @const\n * @type {number}\n */\nconst PRELOAD_NUM = 3;\n\nexport default class CenterImage extends Component {\n\n    static defaultProps = {\n        prefixCls: 'cui'\n    };\n\n    state = {\n        loading: true,\n        error: false,\n        loaded: false\n    }\n\n    componentWillMount() {\n        this.loadImg();\n    }\n\n    componentWillReceiveProps() {\n        !this.state.loaded && this.loadImg();\n    }\n\n    loadImg() {\n        const {index, current, lazysrc} = this.props;\n\n        if (lazysrc && index <= current + PRELOAD_NUM && index >= current - PRELOAD_NUM) {\n            let img = new Image();\n\n            img.src = lazysrc;\n            img.onload = () => {\n                this.setState({\n                    loading: false\n                });\n            };\n            img.onerror = () => {\n                this.setState({\n                    loading: false,\n                    error: true\n                });\n            };\n        }\n    }\n\n    onImgLoad(e) {\n\n        this.setState({loaded: true});\n\n        const target = e.target;\n        const {naturalHeight: h, naturalWidth: w} = target;\n        const r = h / w;\n        const height = window.innerHeight || window.screen.availHeight;\n        const width = window.innerWidth || window.screen.availWidth;\n        const rate = height / width;\n\n        let imgStyle = {};\n\n        if (r >= 3.5) {\n            target.setAttribute('long', true);\n        }\n\n        if (r > rate) {\n            imgStyle.height = height + 'px';\n            imgStyle.width = w * height / h + 'px';\n            imgStyle.left = width / 2 - (w * height / h) / 2 + 'px';\n        }\n        else if (r < rate) {\n            imgStyle.width = width + 'px';\n            imgStyle.height = h * width / w + 'px';\n            imgStyle.top = height / 2 - (h * width / w) / 2 + 'px';\n        }\n        else {\n            imgStyle.width = width;\n            imgStyle.height = height;\n        }\n\n        setStyle(target, 'width', imgStyle.width);\n        setStyle(target, 'height', imgStyle.height);\n        imgStyle.left && setStyle(target, 'left', imgStyle.left);\n        imgStyle.top && setStyle(target, 'top', imgStyle.top);\n\n        target.setAttribute('rate', 1 / r);\n    }\n\n    render() {\n        const {prefixCls, index, current, lazysrc, ...childProps} = this.props;\n        const {loading, error} = this.state;\n\n        const img = (\n            <img onLoad={this.onImgLoad.bind(this)} src={lazysrc} {...childProps} />\n        );\n        // init first image, others have been preloaded\n        if (index === current) {\n            return img;\n        }\n        if (loading) {\n            return (\n                <div className={`${prefixCls}-centerimage-loading`}>\n                    <div className={`${prefixCls}-centerimage-loading-icon`}>\n                        <Icon type=\"loading\" />\n                    </div>\n                </div>\n            );\n        }\n        if (error) {\n            return (\n                <div className={`${prefixCls}-centerimage-error`}>\n                    <div className={`${prefixCls}-centerimage-error-icon`}>加载失败</div>\n                </div>\n            );\n        }\n\n        return img;\n    }\n}\n"],"file":"CenterImage.js"}