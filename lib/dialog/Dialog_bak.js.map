{"version":3,"names":[],"mappings":"","sources":["dialog/Dialog_bak.js"],"sourcesContent":["/**\n * @file Dialog\n * @author wuqi57(441984145@qq.com)\n * @time 17/6/29\n */\n\nimport {h, Component} from 'preact';\nimport classNames from 'classnames';\n\nimport Button from '../button/Button';\nimport {lockWindow, unLockWindow} from '../util/windowScrollHelper';\nimport {hasClass} from '../util/dom';\n\n\nexport default class Dialog extends Component {\n\n    static defaultProps = {\n        prefixCls: 'cui',\n        show: false,\n        close: true,\n        maskClickClose: false,\n        buttons: []\n    };\n\n    constructor(props) {\n        super(props);\n\n        /**\n         * 初始状态\n         *\n         * @private\n         * @type {Object}\n         */\n        this.state = {\n            show: props.show\n        };\n\n        // 是否是回调通知导致父组件设置显示隐藏状态\n        // true：不在触发onShow onHide回调   false：触发回调\n        // 应用场景: 组件内部调用显示与隐藏，如关闭按钮，点击背景关闭等操作，操作成功触发的onHide要求父组件重置子组件显示隐藏状态\n        //          此时会重新触发组件渲染，此时不再要求触发onShow onHide回调，静默处理显示隐藏状态\n        this.propsUpdateEqual = false;\n\n        // 是否是父组件通过props控制组件显示隐藏\n        // 触发onShow onHide回调时是否通知父组件更新props中的显示隐藏状态\n        // true: 是父组件设置状态，不再触发状态更新   false: 组件内部设置状态，需要触发状态更新\n        // 应用场景：父组件设置显示隐藏，回调时不再要求重置父组件状态\n        this.propsUpdateShow = false;\n    }\n\n    /**\n     * 父级修改属性\n     *\n     * @private\n     * @param {Object} nextProps 更改后的属性值\n     */\n    componentWillReceiveProps(nextProps) {\n        let show = nextProps.show;\n\n        if (show === this.state.show) {\n            this.propsUpdateEqual = true;\n            return;\n        }\n\n        this.propsUpdateEqual = false;\n        this.propsUpdateShow = true;\n\n        if (show) {\n            this.setState({\n                show: true\n            });\n            return;\n        }\n\n        this.hide();\n    }\n\n    /**\n     * 隐藏浮层\n     *\n     * @public\n     */\n    hide() {\n        if (this.state.show) {\n            this.setState({show: false});\n        }\n    }\n\n    toggleLockWindow(lock) {\n        lock ? lockWindow() : unLockWindow();\n    }\n\n    onMaskClick(e) {\n        const {prefixCls, maskClickClose} = this.props;\n        if (maskClickClose && hasClass(e.target, `${prefixCls}-dialog`)) {\n            this.hide();\n        }\n        else {\n            e.stopPropagation();\n        }\n    }\n\n    // 初始化完成，如果show，则触发onShow事件，初始化hide，不用触发onHide事件\n    componentDidMount() {\n        let onShow = this.props.onShow;\n        let show = this.state.show;\n\n        show && this.toggleLockWindow(true) && onShow && onShow();\n    }\n\n    // 状态更新后，可能是props改变，也可能是state改变触发的\n    componentDidUpdate() {\n        const {onShow, onHide} = this.props;\n        const stateShow = this.state.show;\n\n        // 防止内容关闭后，外部监控状态并更新props时重新触发事件\n        if (this.propsUpdateEqual) {\n            this.propsUpdateEqual = false;\n            return;\n        }\n\n        if (stateShow) {\n            this.toggleLockWindow(true);\n            onShow && onShow(this.propsUpdateShow);\n        }\n        else {\n            this.toggleLockWindow(false);\n            onHide && onHide(this.propsUpdateShow);\n        }\n\n        this.propsUpdateShow = false;\n    }\n\n    // 销毁前如果状态是显示，则需要考虑解锁屏幕\n    componentWillUnmount() {\n        this.state.show && this.toggleLockWindow(false);\n    }\n\n    /**\n     * 渲染浮层头部\n     *\n     * @private\n     * @return {XML}\n     */\n    renderTitle() {\n        const {prefixCls, title} = this.props;\n\n        return (\n            <h2 className={`${prefixCls}-dialog-header`}>{title}</h2>\n        );\n    }\n\n    /**\n     * 渲染关闭按钮\n     *\n     * @private\n     * @return {XML}\n     */\n    renderClose() {\n        const {prefixCls, closeContent} = this.props;\n\n        return (\n            <span\n                onClick={this.hide.bind(this)}\n                className={`${prefixCls}-dialog-close`}\n            >\n                {closeContent ? closeContent : '×'}\n            </span>\n        );\n    }\n\n    /**\n     * 渲染底部button\n     *\n     * @private\n     * @return {XML}\n     */\n    renderFooter() {\n        const {prefixCls, buttons} = this.props;\n\n        let btnsDom = buttons.map(button => {\n            const {type = 'default', value, size = 'large', ...others} = button;\n\n            return (\n                <div className={`${prefixCls}-dialog-footer-item`}>\n                    <Button type={type} size={size} {...others}>\n                        {value}\n                    </Button>\n                </div>\n            );\n        });\n\n        return (\n            <div className={`${prefixCls}-dialog-footer`}>\n                {btnsDom}\n            </div>\n        );\n    }\n\n    render() {\n        const {\n            prefixCls,\n            className,\n            width,\n            top,\n            children,\n            close,\n            title,\n            buttons,\n            maskClickClose,\n            ...others\n        } = this.props;\n\n        const show = this.state.show;\n\n        const dialogCls = classNames({\n            [`${prefixCls}-dialog`]: true,\n            'show': show,\n            [className]: className\n        });\n\n        const dialogWrapCls = classNames({\n            [`${prefixCls}-dialog-wrap`]: true,\n            'vertical-middle': (top == null)\n        });\n\n        const dialogStyle = ''\n            + (width ? `width:${width};` : '')\n            + (top != null ? `top:${top}` : '');\n\n        return (\n            <div className={dialogCls} {...others} onClick={e => maskClickClose && this.onMaskClick(e)}>\n                <div className={dialogWrapCls} style={dialogStyle}>\n                    {title ? this.renderTitle() : null}\n                    {close ? this.renderClose() : null}\n                    <div className={`${prefixCls}-dialog-body`}>\n                        {children}\n                    </div>\n                    {buttons && buttons.length ? this.renderFooter() : null}\n                </div>\n            </div>\n        );\n    }\n}\n"],"file":"Dialog_bak.js"}